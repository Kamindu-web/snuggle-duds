{% doc %}
  @prompt
    I need a T-shirt, hoodie, cap, hat, bag, and shorts mockup design.
    
    Then
    When choosing T-shirts - Adults, Kids
    01) Adults - 2 options Male or Female
    02) Kids - 2 options Female or Male
    
    Or
    When choosing Hoodies - Adults, Kids
    01) Adults - 2 options Male or Female
    02) Kids - 2 options Female or Male
    
    T-shirts and Hoodies
    
    I want to change the t-shirt sample I have uploaded.
    
    I want to choose the unlimited upload option for our designs.
    
    Add an option to change the size and rotation of the gizmo display. The customer needs an option to upload the design. Select the size option, send me an email and get the parts, customer details.
    , I need a T-shirt, hoodie, cap, hat, bag, and shorts mockup design.
    
    Then
    When choosing T-shirts - Adults, Kids
    01) Adults - 2 options Male or Female
    02) Kids - 2 options Female or Male
    
    Or
    When choosing Hoodies - Adults, Kids
    01) Adults - 2 options Male or Female
    02) Kids - 2 options Female or Male
    
    T-shirts and Hoodies
    
    I want to change the t-shirt sample I have uploaded.
    
    Add an option to change the size and rotation of the gizmo display. The customer needs an option to upload the design. Select the size option, send me an email and get the parts, customer details., I need a T-shirt, hoodie, cap, hat, bag, and shorts mockup design.
    
    Then
    When choosing T-shirts - Adults, Kids
    01) Adults - 2 options Male or Female
    02) Kids - 2 options Female or Male
    
    Or
    When choosing Hoodies - Adults, Kids
    01) Adults - 2 options Male or Female
    02) Kids - 2 options Female or Male
    
    
    The customer needs an option to upload the designs.
    Add an option to change the size , place and rotation of the gizmo display. 
    
    send me an email and get the parts, customer details.
    
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-mockup-designer-{{ ai_gen_id }} {
    display: block;
    width: {{ block.settings.desktop_width_percent }}%;
    max-width: 100%;
    padding: 40px 20px;
    background-color: {{ block.settings.background_color }};
    color: {{ block.settings.text_color }};
  }

  .ai-mockup-designer-container-{{ ai_gen_id }} {
    max-width: 1400px;
    margin: 0 auto;
  }

  .ai-mockup-designer-header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 40px;
  }

  .ai-mockup-designer-title-{{ ai_gen_id }} {
    font-size: 36px;
    margin: 0 0 12px;
    color: {{ block.settings.text_color }};
  }

  .ai-mockup-designer-subtitle-{{ ai_gen_id }} {
    font-size: 18px;
    color: {{ block.settings.text_color }};
    opacity: 0.8;
  }

  .ai-mockup-designer-grid-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    gap: 40px;
    margin-bottom: 40px;
  }

  @media (max-width: 968px) {
    .ai-mockup-designer-grid-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
    }
  }

  .ai-mockup-designer-preview-section-{{ ai_gen_id }} {
    background-color: #f8f8f8;
    border-radius: 12px;
    padding: 30px;
    position: relative;
  }

  .ai-mockup-designer-preview-container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
    min-height: 500px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-mockup-designer-mockup-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
  }

  .ai-mockup-designer-mockup-image-{{ ai_gen_id }} {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 8px;
  }

  .ai-mockup-designer-design-layer-{{ ai_gen_id }} {
    position: absolute;
    pointer-events: none;
    transform-origin: center center;
  }

  .ai-mockup-designer-design-layer-{{ ai_gen_id }} img {
    display: block;
    width: 100%;
    height: auto;
  }

  .ai-mockup-designer-placeholder-{{ ai_gen_id }} {
    text-align: center;
    color: #999;
    padding: 80px 20px;
  }

  .ai-mockup-designer-placeholder-{{ ai_gen_id }} svg {
    width: 120px;
    height: 120px;
    margin-bottom: 20px;
    opacity: 0.3;
  }

  .ai-mockup-designer-placeholder-text-{{ ai_gen_id }} {
    font-size: 16px;
    margin: 0;
  }

  .ai-mockup-designer-controls-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .ai-mockup-designer-card-{{ ai_gen_id }} {
    background-color: white;
    padding: 24px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .ai-mockup-designer-card-title-{{ ai_gen_id }} {
    font-size: 20px;
    font-weight: 600;
    margin: 0 0 20px;
    color: {{ block.settings.text_color }};
  }

  .ai-mockup-designer-form-group-{{ ai_gen_id }} {
    margin-bottom: 20px;
  }

  .ai-mockup-designer-label-{{ ai_gen_id }} {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    font-size: 14px;
    color: {{ block.settings.text_color }};
  }

  .ai-mockup-designer-select-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background-color: white;
    font-size: 15px;
    cursor: pointer;
    transition: border-color 0.3s ease;
  }

  .ai-mockup-designer-select-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.button_color }};
  }

  .ai-mockup-designer-upload-zone-{{ ai_gen_id }} {
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background-color: #fafafa;
  }

  .ai-mockup-designer-upload-zone-{{ ai_gen_id }}:hover {
    border-color: {{ block.settings.button_color }};
    background-color: #f0f0f0;
  }

  .ai-mockup-designer-upload-input-{{ ai_gen_id }} {
    display: none;
  }

  .ai-mockup-designer-upload-icon-{{ ai_gen_id }} {
    width: 56px;
    height: 56px;
    margin: 0 auto 16px;
    color: {{ block.settings.button_color }};
    opacity: 0.6;
  }

  .ai-mockup-designer-upload-text-{{ ai_gen_id }} {
    font-size: 15px;
    color: #666;
    margin: 0;
  }

  .ai-mockup-designer-upload-hint-{{ ai_gen_id }} {
    font-size: 13px;
    color: #999;
    margin: 8px 0 0;
  }

  .ai-mockup-designer-thumbnails-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 12px;
    margin-top: 20px;
  }

  .ai-mockup-designer-thumbnail-{{ ai_gen_id }} {
    position: relative;
    aspect-ratio: 1;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.3s ease;
  }

  .ai-mockup-designer-thumbnail-{{ ai_gen_id }}:hover {
    border-color: {{ block.settings.button_color }};
    transform: scale(1.05);
  }

  .ai-mockup-designer-thumbnail-{{ ai_gen_id }}.active {
    border-color: {{ block.settings.button_color }};
    box-shadow: 0 0 0 2px {{ block.settings.button_color }};
  }

  .ai-mockup-designer-thumbnail-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-mockup-designer-thumbnail-remove-{{ ai_gen_id }} {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 24px;
    height: 24px;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    line-height: 1;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .ai-mockup-designer-thumbnail-{{ ai_gen_id }}:hover .ai-mockup-designer-thumbnail-remove-{{ ai_gen_id }} {
    opacity: 1;
  }

  .ai-mockup-designer-slider-group-{{ ai_gen_id }} {
    margin-bottom: 24px;
  }

  .ai-mockup-designer-slider-header-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .ai-mockup-designer-slider-label-{{ ai_gen_id }} {
    font-size: 14px;
    font-weight: 500;
    color: {{ block.settings.text_color }};
  }

  .ai-mockup-designer-slider-value-{{ ai_gen_id }} {
    font-size: 14px;
    font-weight: 600;
    color: {{ block.settings.button_color }};
  }

  .ai-mockup-designer-slider-{{ ai_gen_id }} {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: linear-gradient(to right, #e0e0e0 0%, #e0e0e0 100%);
    outline: none;
    -webkit-appearance: none;
  }

  .ai-mockup-designer-slider-{{ ai_gen_id }}::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: {{ block.settings.button_color }};
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .ai-mockup-designer-slider-{{ ai_gen_id }}::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: {{ block.settings.button_color }};
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .ai-mockup-designer-input-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 15px;
    transition: border-color 0.3s ease;
  }

  .ai-mockup-designer-input-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.button_color }};
  }

  .ai-mockup-designer-textarea-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 15px;
    min-height: 120px;
    resize: vertical;
    transition: border-color 0.3s ease;
  }

  .ai-mockup-designer-textarea-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.button_color }};
  }

  .ai-mockup-designer-submit-{{ ai_gen_id }} {
    width: 100%;
    padding: 16px 32px;
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .ai-mockup-designer-submit-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .ai-mockup-designer-success-{{ ai_gen_id }} {
    padding: 16px 20px;
    background-color: #d4edda;
    color: #155724;
    border-radius: 6px;
    margin-top: 20px;
    text-align: center;
    font-weight: 500;
  }

  .ai-mockup-designer-error-{{ ai_gen_id }} {
    padding: 16px 20px;
    background-color: #f8d7da;
    color: #721c24;
    border-radius: 6px;
    margin-top: 20px;
  }

  .ai-mockup-designer-hidden-{{ ai_gen_id }} {
    display: none;
  }
{% endstyle %}

<mockup-designer-{{ ai_gen_id }} class="ai-mockup-designer-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-mockup-designer-container-{{ ai_gen_id }}">
    <div class="ai-mockup-designer-header-{{ ai_gen_id }}">
      <h2 class="ai-mockup-designer-title-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
      <p class="ai-mockup-designer-subtitle-{{ ai_gen_id }}">{{ block.settings.subheading }}</p>
    </div>

    <div class="ai-mockup-designer-grid-{{ ai_gen_id }}">
      <div class="ai-mockup-designer-preview-section-{{ ai_gen_id }}">
        <div class="ai-mockup-designer-preview-container-{{ ai_gen_id }}">
          <div class="ai-mockup-designer-mockup-display-{{ ai_gen_id }}">
            <div class="ai-mockup-designer-placeholder-{{ ai_gen_id }}">
              {{ 'product-1' | placeholder_svg_tag }}
              <p class="ai-mockup-designer-placeholder-text-{{ ai_gen_id }}">Select a product to preview</p>
            </div>
          </div>
        </div>
      </div>

      <div class="ai-mockup-designer-controls-{{ ai_gen_id }}">
        <div class="ai-mockup-designer-card-{{ ai_gen_id }}">
          <h3 class="ai-mockup-designer-card-title-{{ ai_gen_id }}">Product Selection</h3>
          
          <div class="ai-mockup-designer-form-group-{{ ai_gen_id }}">
            <label class="ai-mockup-designer-label-{{ ai_gen_id }}">Product Type</label>
            <select class="ai-mockup-designer-select-{{ ai_gen_id }}" data-product-type>
              <option value="">Choose product type</option>
              <option value="tshirt">T-shirt</option>
              <option value="hoodie">Hoodie</option>
              <option value="cap">Cap</option>
              <option value="hat">Hat</option>
              <option value="bag">Bag</option>
              <option value="shorts">Shorts</option>
            </select>
          </div>

          <div class="ai-mockup-designer-form-group-{{ ai_gen_id }} ai-mockup-designer-hidden-{{ ai_gen_id }}" data-age-group>
            <label class="ai-mockup-designer-label-{{ ai_gen_id }}">Age Group</label>
            <select class="ai-mockup-designer-select-{{ ai_gen_id }}" data-age-select>
              <option value="">Choose age group</option>
              <option value="adults">Adults</option>
              <option value="kids">Kids</option>
            </select>
          </div>

          <div class="ai-mockup-designer-form-group-{{ ai_gen_id }} ai-mockup-designer-hidden-{{ ai_gen_id }}" data-gender-group>
            <label class="ai-mockup-designer-label-{{ ai_gen_id }}">Gender</label>
            <select class="ai-mockup-designer-select-{{ ai_gen_id }}" data-gender-select>
              <option value="">Choose gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>
        </div>

        <div class="ai-mockup-designer-card-{{ ai_gen_id }}">
          <h3 class="ai-mockup-designer-card-title-{{ ai_gen_id }}">Upload Your Design</h3>
          
          <div class="ai-mockup-designer-upload-zone-{{ ai_gen_id }}" data-upload-zone>
            <input 
              type="file" 
              class="ai-mockup-designer-upload-input-{{ ai_gen_id }}" 
              data-file-input 
              accept="image/*" 
              multiple
            >
            <svg class="ai-mockup-designer-upload-icon-{{ ai_gen_id }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
            </svg>
            <p class="ai-mockup-designer-upload-text-{{ ai_gen_id }}">Click to upload or drag and drop</p>
            <p class="ai-mockup-designer-upload-hint-{{ ai_gen_id }}">PNG, JPG, SVG (max 5MB each)</p>
          </div>

          <div class="ai-mockup-designer-thumbnails-{{ ai_gen_id }}" data-thumbnails></div>
        </div>

        <div class="ai-mockup-designer-card-{{ ai_gen_id }}">
          <h3 class="ai-mockup-designer-card-title-{{ ai_gen_id }}">Design Position & Controls</h3>
          
          <div class="ai-mockup-designer-slider-group-{{ ai_gen_id }}">
            <div class="ai-mockup-designer-slider-header-{{ ai_gen_id }}">
              <span class="ai-mockup-designer-slider-label-{{ ai_gen_id }}">Size</span>
              <span class="ai-mockup-designer-slider-value-{{ ai_gen_id }}" data-size-value>100%</span>
            </div>
            <input 
              type="range" 
              class="ai-mockup-designer-slider-{{ ai_gen_id }}" 
              data-size-slider 
              min="30" 
              max="200" 
              value="100"
            >
          </div>

          <div class="ai-mockup-designer-slider-group-{{ ai_gen_id }}">
            <div class="ai-mockup-designer-slider-header-{{ ai_gen_id }}">
              <span class="ai-mockup-designer-slider-label-{{ ai_gen_id }}">Horizontal Position</span>
              <span class="ai-mockup-designer-slider-value-{{ ai_gen_id }}" data-x-value>50%</span>
            </div>
            <input 
              type="range" 
              class="ai-mockup-designer-slider-{{ ai_gen_id }}" 
              data-x-slider 
              min="0" 
              max="100" 
              value="50"
            >
          </div>

          <div class="ai-mockup-designer-slider-group-{{ ai_gen_id }}">
            <div class="ai-mockup-designer-slider-header-{{ ai_gen_id }}">
              <span class="ai-mockup-designer-slider-label-{{ ai_gen_id }}">Vertical Position</span>
              <span class="ai-mockup-designer-slider-value-{{ ai_gen_id }}" data-y-value>50%</span>
            </div>
            <input 
              type="range" 
              class="ai-mockup-designer-slider-{{ ai_gen_id }}" 
              data-y-slider 
              min="0" 
              max="100" 
              value="50"
            >
          </div>

          <div class="ai-mockup-designer-slider-group-{{ ai_gen_id }}">
            <div class="ai-mockup-designer-slider-header-{{ ai_gen_id }}">
              <span class="ai-mockup-designer-slider-label-{{ ai_gen_id }}">Rotation</span>
              <span class="ai-mockup-designer-slider-value-{{ ai_gen_id }}" data-rotation-value>0°</span>
            </div>
            <input 
              type="range" 
              class="ai-mockup-designer-slider-{{ ai_gen_id }}" 
              data-rotation-slider 
              min="0" 
              max="360" 
              value="0"
            >
          </div>
        </div>
      </div>
    </div>

    {%- form 'contact' -%}
      <input type="hidden" name="contact[subject]" value="Product Mockup Design Request">
      <input type="hidden" name="contact[product_type]" data-form-product-type>
      <input type="hidden" name="contact[age_group]" data-form-age-group>
      <input type="hidden" name="contact[gender]" data-form-gender>
      <input type="hidden" name="contact[design_size]" data-form-size>
      <input type="hidden" name="contact[design_position_x]" data-form-x>
      <input type="hidden" name="contact[design_position_y]" data-form-y>
      <input type="hidden" name="contact[design_rotation]" data-form-rotation>
      <input type="hidden" name="contact[design_files]" data-form-files>

      <div class="ai-mockup-designer-card-{{ ai_gen_id }}">
        <h3 class="ai-mockup-designer-card-title-{{ ai_gen_id }}">Your Contact Information</h3>
        
        <div class="ai-mockup-designer-form-group-{{ ai_gen_id }}">
          <label class="ai-mockup-designer-label-{{ ai_gen_id }}">Full Name *</label>
          <input 
            type="text" 
            name="contact[name]" 
            class="ai-mockup-designer-input-{{ ai_gen_id }}" 
            required
          >
        </div>

        <div class="ai-mockup-designer-form-group-{{ ai_gen_id }}">
          <label class="ai-mockup-designer-label-{{ ai_gen_id }}">Email Address *</label>
          <input 
            type="email" 
            name="contact[email]" 
            class="ai-mockup-designer-input-{{ ai_gen_id }}" 
            required
          >
        </div>

        <div class="ai-mockup-designer-form-group-{{ ai_gen_id }}">
          <label class="ai-mockup-designer-label-{{ ai_gen_id }}">Phone Number</label>
          <input 
            type="tel" 
            name="contact[phone]" 
            class="ai-mockup-designer-input-{{ ai_gen_id }}"
          >
        </div>

        <div class="ai-mockup-designer-form-group-{{ ai_gen_id }}">
          <label class="ai-mockup-designer-label-{{ ai_gen_id }}">Additional Details (Size, Quantity, Delivery Date, etc.)</label>
          <textarea 
            name="contact[message]" 
            class="ai-mockup-designer-textarea-{{ ai_gen_id }}"
            placeholder="Please include any specific requirements..."
          ></textarea>
        </div>

        <button type="submit" class="ai-mockup-designer-submit-{{ ai_gen_id }}">
          {{ block.settings.submit_button_text }}
        </button>

        {%- if form.posted_successfully? -%}
          <div class="ai-mockup-designer-success-{{ ai_gen_id }}">
            {{ block.settings.success_message }}
          </div>
        {%- endif -%}

        {%- if form.errors -%}
          <div class="ai-mockup-designer-error-{{ ai_gen_id }}">
            <p><strong>Please correct the following:</strong></p>
            <ul>
              {%- for field in form.errors -%}
                <li>{{ field | capitalize }} {{ form.errors.messages[field] }}</li>
              {%- endfor -%}
            </ul>
          </div>
        {%- endif -%}
      </div>
    {%- endform -%}
  </div>
</mockup-designer-{{ ai_gen_id }}>

<script>
(function() {
  class MockupDesigner{{ ai_gen_id }} extends HTMLElement {
    constructor() {
      super();
      this.uploadedDesigns = [];
      this.activeDesignIndex = null;
      this.designControls = {
        size: 100,
        x: 50,
        y: 50,
        rotation: 0
      };
      this.mockupImages = {
        tshirt: {
          adults: {
            male: {{ block.settings.tshirt_adult_male | image_url: width: 1000 | json }},
            female: {{ block.settings.tshirt_adult_female | image_url: width: 1000 | json }}
          },
          kids: {
            male: {{ block.settings.tshirt_kids_male | image_url: width: 1000 | json }},
            female: {{ block.settings.tshirt_kids_female | image_url: width: 1000 | json }}
          }
        },
        hoodie: {
          adults: {
            male: {{ block.settings.hoodie_adult_male | image_url: width: 1000 | json }},
            female: {{ block.settings.hoodie_adult_female | image_url: width: 1000 | json }}
          },
          kids: {
            male: {{ block.settings.hoodie_kids_male | image_url: width: 1000 | json }},
            female: {{ block.settings.hoodie_kids_female | image_url: width: 1000 | json }}
          }
        },
        cap: {{ block.settings.cap_image | image_url: width: 1000 | json }},
        hat: {{ block.settings.hat_image | image_url: width: 1000 | json }},
        bag: {{ block.settings.bag_image | image_url: width: 1000 | json }},
        shorts: {{ block.settings.shorts_image | image_url: width: 1000 | json }}
      };
    }

    connectedCallback() {
      this.productTypeSelect = this.querySelector('[data-product-type]');
      this.ageGroupContainer = this.querySelector('[data-age-group]');
      this.ageSelect = this.querySelector('[data-age-select]');
      this.genderGroupContainer = this.querySelector('[data-gender-group]');
      this.genderSelect = this.querySelector('[data-gender-select]');
      this.uploadZone = this.querySelector('[data-upload-zone]');
      this.fileInput = this.querySelector('[data-file-input]');
      this.thumbnailsContainer = this.querySelector('[data-thumbnails]');
      this.sizeSlider = this.querySelector('[data-size-slider]');
      this.sizeValue = this.querySelector('[data-size-value]');
      this.xSlider = this.querySelector('[data-x-slider]');
      this.xValue = this.querySelector('[data-x-value]');
      this.ySlider = this.querySelector('[data-y-slider]');
      this.yValue = this.querySelector('[data-y-value]');
      this.rotationSlider = this.querySelector('[data-rotation-slider]');
      this.rotationValue = this.querySelector('[data-rotation-value]');
      this.mockupDisplay = this.querySelector('.ai-mockup-designer-mockup-display-{{ ai_gen_id }}');
      
      this.formProductType = this.querySelector('[data-form-product-type]');
      this.formAgeGroup = this.querySelector('[data-form-age-group]');
      this.formGender = this.querySelector('[data-form-gender]');
      this.formSize = this.querySelector('[data-form-size]');
      this.formX = this.querySelector('[data-form-x]');
      this.formY = this.querySelector('[data-form-y]');
      this.formRotation = this.querySelector('[data-form-rotation]');
      this.formFiles = this.querySelector('[data-form-files]');

      this.setupEventListeners();
    }

    setupEventListeners() {
      this.productTypeSelect.addEventListener('change', () => this.handleProductTypeChange());
      this.ageSelect.addEventListener('change', () => this.handleAgeChange());
      this.genderSelect.addEventListener('change', () => this.handleGenderChange());
      
      this.uploadZone.addEventListener('click', () => this.fileInput.click());
      this.fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
      
      this.uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        this.uploadZone.style.borderColor = '{{ block.settings.button_color }}';
      });
      
      this.uploadZone.addEventListener('dragleave', () => {
        this.uploadZone.style.borderColor = '';
      });
      
      this.uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        this.uploadZone.style.borderColor = '';
        this.handleFileUpload({ target: { files: e.dataTransfer.files } });
      });

      this.sizeSlider.addEventListener('input', () => this.handleSizeChange());
      this.xSlider.addEventListener('input', () => this.handleXChange());
      this.ySlider.addEventListener('input', () => this.handleYChange());
      this.rotationSlider.addEventListener('input', () => this.handleRotationChange());
    }

    handleProductTypeChange() {
      const productType = this.productTypeSelect.value;
      this.formProductType.value = productType;
      
      if (productType === 'tshirt' || productType === 'hoodie') {
        this.ageGroupContainer.classList.remove('ai-mockup-designer-hidden-{{ ai_gen_id }}');
        this.genderGroupContainer.classList.add('ai-mockup-designer-hidden-{{ ai_gen_id }}');
        this.ageSelect.value = '';
        this.genderSelect.value = '';
      } else {
        this.ageGroupContainer.classList.add('ai-mockup-designer-hidden-{{ ai_gen_id }}');
        this.genderGroupContainer.classList.add('ai-mockup-designer-hidden-{{ ai_gen_id }}');
        this.ageSelect.value = '';
        this.genderSelect.value = '';
        this.updateMockup();
      }
    }

    handleAgeChange() {
      const ageGroup = this.ageSelect.value;
      this.formAgeGroup.value = ageGroup;
      
      if (ageGroup) {
        this.genderGroupContainer.classList.remove('ai-mockup-designer-hidden-{{ ai_gen_id }}');
        this.genderSelect.value = '';
      } else {
        this.genderGroupContainer.classList.add('ai-mockup-designer-hidden-{{ ai_gen_id }}');
      }
    }

    handleGenderChange() {
      const gender = this.genderSelect.value;
      this.formGender.value = gender;
      
      if (gender) {
        this.updateMockup();
      }
    }

    handleFileUpload(e) {
      const files = Array.from(e.target.files);
      
      files.forEach(file => {
        if (file.size > 5 * 1024 * 1024) {
          alert('File size must be less than 5MB: ' + file.name);
          return;
        }
        
        const reader = new FileReader();
        reader.onload = (event) => {
          this.uploadedDesigns.push({
            name: file.name,
            data: event.target.result
          });
          this.renderThumbnails();
          
          if (this.activeDesignIndex === null) {
            this.setActiveDesign(this.uploadedDesigns.length - 1);
          }
        };
        reader.readAsDataURL(file);
      });
      
      this.fileInput.value = '';
    }

    renderThumbnails() {
      this.thumbnailsContainer.innerHTML = '';
      
      this.uploadedDesigns.forEach((design, index) => {
        const thumbnail = document.createElement('div');
        thumbnail.className = 'ai-mockup-designer-thumbnail-{{ ai_gen_id }}';
        if (index === this.activeDesignIndex) {
          thumbnail.classList.add('active');
        }
        
        thumbnail.innerHTML = `
          <img src="${design.data}" alt="${design.name}">
          <button class="ai-mockup-designer-thumbnail-remove-{{ ai_gen_id }}" data-remove="${index}">×</button>
        `;
        
        thumbnail.addEventListener('click', (e) => {
          if (!e.target.hasAttribute('data-remove')) {
            this.setActiveDesign(index);
          }
        });
        
        const removeBtn = thumbnail.querySelector('[data-remove]');
        removeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.removeDesign(index);
        });
        
        this.thumbnailsContainer.appendChild(thumbnail);
      });
      
      this.updateFormFiles();
    }

    setActiveDesign(index) {
      this.activeDesignIndex = index;
      this.renderThumbnails();
      this.updateMockup();
    }

    removeDesign(index) {
      this.uploadedDesigns.splice(index, 1);
      
      if (this.activeDesignIndex === index) {
        this.activeDesignIndex = this.uploadedDesigns.length > 0 ? 0 : null;
      } else if (this.activeDesignIndex > index) {
        this.activeDesignIndex--;
      }
      
      this.renderThumbnails();
      this.updateMockup();
    }

    handleSizeChange() {
      const size = this.sizeSlider.value;
      this.designControls.size = size;
      this.sizeValue.textContent = size + '%';
      this.formSize.value = size;
      this.updateMockup();
    }

    handleXChange() {
      const x = this.xSlider.value;
      this.designControls.x = x;
      this.xValue.textContent = x + '%';
      this.formX.value = x;
      this.updateMockup();
    }

    handleYChange() {
      const y = this.ySlider.value;
      this.designControls.y = y;
      this.yValue.textContent = y + '%';
      this.formY.value = y;
      this.updateMockup();
    }

    handleRotationChange() {
      const rotation = this.rotationSlider.value;
      this.designControls.rotation = rotation;
      this.rotationValue.textContent = rotation + '°';
      this.formRotation.value = rotation;
      this.updateMockup();
    }

    updateMockup() {
      const productType = this.productTypeSelect.value;
      const ageGroup = this.ageSelect.value;
      const gender = this.genderSelect.value;
      
      let mockupUrl = null;
      
      if (productType === 'tshirt' || productType === 'hoodie') {
        if (ageGroup && gender) {
          mockupUrl = this.mockupImages[productType][ageGroup][gender];
        }
      } else if (productType) {
        mockupUrl = this.mockupImages[productType];
      }
      
      if (mockupUrl && mockupUrl !== 'null') {
        const activeDesign = this.uploadedDesigns[this.activeDesignIndex];
        const size = this.designControls.size;
        const x = this.designControls.x;
        const y = this.designControls.y;
        const rotation = this.designControls.rotation;
        
        this.mockupDisplay.innerHTML = `
          <div class="ai-mockup-designer-mockup-wrapper-{{ ai_gen_id }}">
            <img src="${mockupUrl}" alt="Mockup" class="ai-mockup-designer-mockup-image-{{ ai_gen_id }}">
            ${activeDesign ? `
              <div class="ai-mockup-designer-design-layer-{{ ai_gen_id }}" style="
                top: ${y}%;
                left: ${x}%;
                width: ${size}%;
                transform: translate(-50%, -50%) rotate(${rotation}deg);
              ">
                <img src="${activeDesign.data}" alt="Design">
              </div>
            ` : ''}
          </div>
        `;
      } else {
        this.mockupDisplay.innerHTML = `
          <div class="ai-mockup-designer-placeholder-{{ ai_gen_id }}">
            {{ 'product-1' | placeholder_svg_tag }}
            <p class="ai-mockup-designer-placeholder-text-{{ ai_gen_id }}">Select a product to preview</p>
          </div>
        `;
      }
    }

    updateFormFiles() {
      const fileNames = this.uploadedDesigns.map(d => d.name).join(', ');
      this.formFiles.value = fileNames;
    }
  }

  customElements.define('mockup-designer-{{ ai_gen_id }}', MockupDesigner{{ ai_gen_id }});
})();
</script>

{% schema %}
{
  "name": "Product mockup designer",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Design Your Custom Product"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Upload your design, position it perfectly, and see it come to life"
    },
    {
      "type": "text",
      "id": "submit_button_text",
      "label": "Submit button text",
      "default": "Submit Design Request"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success message",
      "default": "Thank you! We've received your design and will contact you shortly."
    },
    {
      "type": "header",
      "content": "T-shirt mockups"
    },
    {
      "type": "image_picker",
      "id": "tshirt_adult_male",
      "label": "Adult male"
    },
    {
      "type": "image_picker",
      "id": "tshirt_adult_female",
      "label": "Adult female"
    },
    {
      "type": "image_picker",
      "id": "tshirt_kids_male",
      "label": "Kids male"
    },
    {
      "type": "image_picker",
      "id": "tshirt_kids_female",
      "label": "Kids female"
    },
    {
      "type": "header",
      "content": "Hoodie mockups"
    },
    {
      "type": "image_picker",
      "id": "hoodie_adult_male",
      "label": "Adult male"
    },
    {
      "type": "image_picker",
      "id": "hoodie_adult_female",
      "label": "Adult female"
    },
    {
      "type": "image_picker",
      "id": "hoodie_kids_male",
      "label": "Kids male"
    },
    {
      "type": "image_picker",
      "id": "hoodie_kids_female",
      "label": "Kids female"
    },
    {
      "type": "header",
      "content": "Other product mockups"
    },
    {
      "type": "image_picker",
      "id": "cap_image",
      "label": "Cap"
    },
    {
      "type": "image_picker",
      "id": "hat_image",
      "label": "Hat"
    },
    {
      "type": "image_picker",
      "id": "bag_image",
      "label": "Bag"
    },
    {
      "type": "image_picker",
      "id": "shorts_image",
      "label": "Shorts"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "desktop_width_percent",
      "label": "Desktop width",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Button hover",
      "default": "#334FB4"
    }
  ],
  "presets": [
    {
      "name": "Product mockup designer"
    }
  ]
}
{% endschema %}